package com.slavlend.Executor;

import com.slavlend.Compiler.Compiler;
import com.slavlend.Parser.Statements.BlockStatement;
import com.slavlend.App;
import com.slavlend.Colors;
import com.slavlend.Lexer.Lexer;
import com.slavlend.Parser.Parser;
import com.slavlend.PolarLogger;
import com.slavlend.Vm.IceVm;

/*
–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –∫–æ–¥–æ–º.
–≠–∫–∑–µ–∫—å—é—Ç–µ—Ä.
 */
@SuppressWarnings("ExtractMethodRecommender")
public class Executor {
    // –∑–∞–ø—É—Å–∫ polar-—Ñ–∞–π–ª–∞
    public static void exec(ExecutorSettings settings) {
        // —Å—Ç–∞—Ç—É—Å - –ø–∞—Ä—Å–∏–Ω–≥
        System.out.println("üó∫Ô∏è Parsing...");
        // –ª–µ–∫—Å–µ—Ä
        Lexer lexer = new Lexer(settings.getCode());
        // —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è
        lexer.Tokenize();

        // –ø–∞—Ä—Å–µ—Ä
        Parser parser = new Parser(
                lexer.getTokens()
        );
        String envPath = settings.getFilePath().substring(0, settings.getFilePath().lastIndexOf('\\'));
        String filePath = settings.getFilePath().substring(
                settings.getFilePath().lastIndexOf('\\')+1
        ).replace(".polar", "");
        parser.setEnvironmentPath(envPath);
        parser.setFileName(filePath);
        App.parser = parser;
        // –ø–∞—Ä—Å–∏–º –∫–æ–¥
        BlockStatement statement = parser.parse();
        // –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º
        System.out.println(Colors.ANSI_CYAN + "üßä Compiling..." + Colors.ANSI_RESET);
        statement.compile();
        // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–≥–≥–µ—Ä
        IceVm.setLogger(PolarLogger.polarLogger);
        // –∏—Å–ø–æ–ª–Ω—è–µ–º
        Compiler.iceVm.run(Compiler.code);
    }
}
